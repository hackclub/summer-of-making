<% content_for :title, "My Orders" %>

<div class="max-w-6xl mx-auto p-4 md:p-8">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <h1 class="text-3xl font-bold text-darker-taupe">My Orders</h1>
    <%= link_to shop_path, class: "bg-forest hover:bg-forest/90 text-white font-bold py-2 px-4 btn-pixel transition-colors duration-200" do %>
      Continue Shopping
    <% end %>
  </div>

  <% if @orders.any? %>
    <!-- Orders list -->
    <div class="space-y-6">
      <% @orders.each do |order| %>
        <div class="bg-soft-bone card-pixel p-6">
          <div class="grid md:grid-cols-4 gap-6 items-center">
            <!-- Order info -->
            <div class="md:col-span-2">
              <div class="flex items-start space-x-4">
                <% if order.shop_item.image.attached? %>
                  <div class="w-16 h-16 bg-white card-pixel p-2 flex-shrink-0">
                    <%= image_tag order.shop_item.image.variant(:thumb), 
                        class: "w-full h-full object-contain",
                        alt: order.shop_item.name %>
                  </div>
                <% else %>
                  <div class="w-16 h-16 bg-white card-pixel p-2 flex-shrink-0 flex items-center justify-center">
                    <span class="text-2xl">üì¶</span>
                  </div>
                <% end %>
                
                <div class="flex-grow min-w-0">
                  <h3 class="text-lg font-bold text-darker-taupe truncate">
                    <%= order.shop_item.name %>
                  </h3>
                  <p class="text-sm text-saddle-taupe">
                    Quantity: <%= order.quantity %>
                  </p>
                  <p class="text-sm text-saddle-taupe">
                    Order #<%= order.id %>
                  </p>
                </div>
              </div>
            </div>

            <!-- Status -->
            <div class="text-center">
              <span class="inline-flex items-center px-3 py-1 text-sm font-medium rounded-full <%= 
                case order.aasm_state
                when 'pending' then 'bg-yellow-100 text-yellow-800'
                when 'awaiting_periodical_fulfillment' then 'bg-blue-100 text-blue-800'
                when 'fulfilled' then 'bg-green-100 text-green-800'
                when 'rejected' then 'bg-red-100 text-red-800'
                when 'on_hold' then 'bg-orange-100 text-orange-800'
                else 'bg-gray-100 text-gray-800'
                end %>">
                <%= order.aasm_state.humanize %>
              </span>
              <p class="text-xs text-saddle-taupe mt-1">
                <%= order.created_at.strftime("%b %d, %Y") %>
              </p>
            </div>

            <!-- Actions -->
            <div class="text-right">
              <%= link_to "View Details", shop_order_path(order), 
                  class: "bg-soft-bone hover:bg-saddle-taupe/10 text-darker-taupe font-bold py-2 px-4 btn-pixel border-2 border-saddle-taupe/30 transition-colors duration-200 text-sm" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Order summary -->
    <div class="mt-8 bg-forest/10 card-pixel p-6">
      <div class="grid md:grid-cols-3 gap-6 text-center">
        <div>
          <p class="text-2xl font-bold text-forest"><%= @orders.count %></p>
          <p class="text-sm text-saddle-taupe">Total Orders</p>
        </div>
        <div>
          <p class="text-2xl font-bold text-green-600"><%= @orders.fulfilled.count %></p>
          <p class="text-sm text-saddle-taupe">Fulfilled</p>
        </div>
        <div>
          <p class="text-2xl font-bold text-yellow-600"><%= @orders.pending.count + @orders.awaiting_periodical_fulfillment.count %></p>
          <p class="text-sm text-saddle-taupe">In Progress</p>
        </div>
      </div>
    </div>

  <% else %>
    <!-- Empty state -->
    <div class="text-center py-16">
      <div class="w-24 h-24 bg-soft-bone rounded-full flex items-center justify-center mx-auto mb-6">
        <span class="text-4xl">üõçÔ∏è</span>
      </div>
      <h2 class="text-2xl font-bold text-darker-taupe mb-4">No Orders Yet</h2>
      <p class="text-lg text-saddle-taupe mb-8">
        Ready to get some awesome Hack Club swag?
      </p>
      <%= link_to "Browse Shop", shop_path, 
          class: "bg-forest hover:bg-forest/90 text-white font-bold py-3 px-6 btn-pixel text-lg transition-colors duration-200" %>
    </div>
  <% end %>
</div>

<style>
.btn-pixel {
  box-shadow: 0 0 0 1px rgba(0,0,0,0.1), 
              2px 2px 0 0 rgba(0,0,0,0.1);
}

.btn-pixel:hover {
  transform: translate(1px, 1px);
  box-shadow: 0 0 0 1px rgba(0,0,0,0.1), 
              1px 1px 0 0 rgba(0,0,0,0.1);
}

.card-pixel {
  box-shadow: 0 0 0 2px rgba(0,0,0,0.1),
              4px 4px 0 0 rgba(0,0,0,0.05);
}
</style>
