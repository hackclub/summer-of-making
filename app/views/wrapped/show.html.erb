<% share_url = @wrapped_user.wrapped_share_token.present? ? shared_wrapped_url(@wrapped_user.wrapped_share_token) : nil %>
<% display_name = @wrapped_user.display_name %>
<% content_for :title, "#{display_name}'s Wrapped" %>
<% content_for :og_title, "#{display_name}'s Summer of Making Wrapped" %>
<% content_for :og_description, "#{display_name} shipped projects, earned shells, and collected highlights in Summer of Making 2025." %>
<% content_for :og_image, asset_url("social_card.png") %>
<% content_for :og_url, share_url || request.original_url %>
<% content_for :twitter_title, "#{display_name}'s Summer of Making Wrapped" %>
<% content_for :twitter_description, "#{display_name} shipped projects, earned shells, and collected highlights in Summer of Making 2025." %>
<% content_for :twitter_image, asset_url("social_card.png") %>
<% order = @wrapped.most_expensive_order %>
<% item = @wrapped.most_expensive_item %>
<% project_time = @wrapped.project_with_most_time %>
<% project_ratio = @wrapped.project_with_highest_shells_per_hour %>
<% project_time_seconds = @wrapped.project_total_seconds(project_time) %>
<% project_ratio_hours = @wrapped.project_total_hours(project_ratio) %>
<% project_ratio_rate = @wrapped.project_shells_per_hour(project_ratio) %>

<% helper_slide = @wrapped.helper_slide? %>
<% helper_tickets_closed = helper_slide ? @wrapped.helper_tickets_closed : nil %>
<% votes_cast = @wrapped.votes_cast %>
<% helper_tickets_opened = helper_slide ? @wrapped.helper_tickets_opened : nil %>
<% shells_rank_data = @wrapped.shells_earned_rank %>
<% has_shells_rank = shells_rank_data.present? && shells_rank_data[:rank].to_i.positive? && shells_rank_data[:total].to_i.positive? %>
<% rank_value = has_shells_rank ? shells_rank_data[:rank].to_i : nil %>
<% total_ranked = has_shells_rank ? shells_rank_data[:total].to_i : nil %>
<% percentile = (total_ranked.to_i.positive? && rank_value) ? ((rank_value.to_f / total_ranked) * 100.0) : nil %>
<% devlogs_count = @wrapped.devlogs_count %>
<% devlog_projects_count = @wrapped.devlog_projects_count %>
<% top_devlog_projects = @wrapped.top_devlog_projects(4) %>
<% total_slides = 11 + (helper_slide ? 1 : 0) + (has_shells_rank ? 1 : 0) %>

<div class="h-full sm:min-h-[calc(100vh-8rem)] w-full flex flex-col items-center justify-center py-10 px-6">
  <div
    class="w-full max-w-5xl"
    data-controller="wrapped"
    data-wrapped-interval-value="8000"
    data-wrapped-username-value="<%= display_name %>"
    <% if share_url.present? %>data-wrapped-share-url-value="<%= share_url %>"<% end %>>
    <div class="relative w-full">
      <button
        type="button"
        class="absolute top-9 right-4 z-30 inline-flex h-10 w-10 items-center justify-center rounded-full bg-slate-900 text-white shadow transition hover:bg-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-900"
        data-action="wrapped#toggleAudio"
        data-wrapped-target="audioToggle"
        data-wrapped-tap-ignore
        aria-pressed="false"
        aria-label="Play soundtrack">
        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M12 3v18a1 1 0 0 1-1.707.707l-4-4A1 1 0 0 1 6 17V7a1 1 0 0 1 .293-.707l4-4A1 1 0 0 1 12 3Zm-4 4.414V16.586L10 18.586V5.414L8 7.414ZM16.5 4a3.5 3.5 0 0 1 0 7h-.75a.75.75 0 0 1 0-1.5h.75a2 2 0 0 0 0-4h-.75a.75.75 0 0 1 0-1.5h.75Zm0 7a3.5 3.5 0 0 1 0 7h-.75a.75.75 0 0 1 0-1.5h.75a2 2 0 0 0 0-4h-.75a.75.75 0 0 1 0-1.5h.75Z" />
        </svg>
        <span class="sr-only">Play soundtrack</span>
      </button>
      <audio
        class="hidden"
        preload="auto"
        src="<%= asset_path("wrapped.mp3") %>"
        data-wrapped-target="audio"
        aria-hidden="true">
      </audio>
      <div
        class="absolute inset-0 z-40 flex flex-col items-center justify-center gap-6 bg-slate-900/90 px-8 text-center text-white transition-opacity duration-500"
        data-wrapped-target="overlay"
        role="dialog"
        aria-modal="true"
        aria-hidden="false"
        aria-labelledby="wrapped-audio-overlay-title">
        <div class="max-w-lg space-y-4">
          <h2 id="wrapped-audio-overlay-title" class="text-3xl font-black tracking-tight sm:text-4xl">Start with the soundtrack</h2>
          <p class="text-base leading-relaxed text-slate-200 sm:text-lg">
            Hit play to launch your Wrapped with the Summer of Making soundtrack. You can pause anytime from the top-right control.
          </p>
        </div>
        <button
          type="button"
          class="inline-flex items-center justify-center rounded-full bg-white px-6 py-3 text-sm font-semibold uppercase tracking-[0.25em] text-slate-900 shadow-lg transition hover:bg-slate-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white"
          data-action="wrapped#startExperience"
          autofocus>
          Start Wrapped
        </button>
      </div>
      <div class="absolute top-6 right-6 left-6 z-20 flex gap-2">
      <% total_slides.times do %>
        <div class="h-1.5 w-full overflow-hidden rounded-full bg-slate-900/25 shadow-[inset_0_0_4px_rgba(15,23,42,0.35)]">
          <div class="h-full w-0 bg-slate-900 transition-[width] duration-[var(--wrapped-interval,8000ms)] shadow-sm" data-wrapped-target="progressBar"></div>
        </div>
      <% end %>
    </div>

    <div
      class="relative h-[560px] w-full overflow-hidden rounded-3xl shadow-2xl"
      data-wrapped-target="slideContainer"
      data-action="click->wrapped#handleTap">
      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-slate-100 via-violet-100 to-sky-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.4em] text-sm text-slate-500 text-balance">Summer of Making 2025</p>
        <h1 class="text-5xl md:text-6xl font-black leading-tight text-balance">
          Hey <%= display_name %>, welcome to your Wrapped.
        </h1>
        <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
          We crunched your projects, shells and shop adventures into a mini highlight reel.
          Sit back and relax, or use your arrow keys to explore each page.
        </p>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-amber-50 via-orange-50 to-rose-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Shells Earned</p>
        <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm">
          <%= image_tag "shell.png", width: 64, alt: "Shell icon", class: "w-14 h-14" %>
          <span
            data-wrapped-target="counter"
            data-wrapped-counter-type="shells"
            data-wrapped-counter-value="<%= @wrapped.shells_earned %>">
            0
          </span>
        </div>
        <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
          Those are the shells you pulled in from your ships this summer.
        </p>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-rose-50 via-red-50 to-amber-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Shells Spent</p>
        <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm">
          <%= image_tag "shell.png", width: 64, alt: "Shell icon", class: "w-14 h-14" %>
          <span
            data-wrapped-target="counter"
            data-wrapped-counter-type="shells"
            data-wrapped-counter-value="<%= @wrapped.shells_spent %>">
            0
          </span>
        </div>
        <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            You re-invested your winnings into gear and goodies worth every <span class="ml-2 line-through text-sm text-slate-500">penny</span> shell.
        </p>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-indigo-50 via-violet-50 to-slate-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Votes Cast</p>
        <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm text-slate-800">
          <span
            data-wrapped-target="counter"
            data-wrapped-counter-type="integer"
            data-wrapped-counter-value="<%= votes_cast %>">
            0
          </span>
          <span class="text-2xl font-semibold text-slate-500">votes</span>
        </div>
        <% if votes_cast.positive? %>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            were they <i>good</i> votes though? that's the question...
          </p>
        <% else %>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            you cannot be serious
          </p>
        <% end %>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-sky-50 via-emerald-50 to-lime-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Devlog Sprint</p>
        <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm text-slate-800">
          <span
            data-wrapped-target="counter"
            data-wrapped-counter-type="integer"
            data-wrapped-counter-value="<%= devlogs_count %>">
            0
          </span>
          <span class="text-2xl font-semibold text-slate-500">devlogs</span>
        </div>
        <% if devlogs_count.positive? %>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            You published them across <span class="font-semibold text-slate-800"><%= pluralize(devlog_projects_count, "project") %></span>.
          </p>
        <% else %>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            No devlogs logged yet—but there’s always next season.
          </p>
        <% end %>
        <% if top_devlog_projects.present? %>
          <div class="mt-4 w-full max-w-md space-y-2 text-sm md:text-base text-slate-600">
            <% top_devlog_projects.each_with_index do |entry, index| %>
              <% project = entry[:project] %>
              <div class="flex items-center justify-between gap-4 rounded-full border border-slate-900/5 bg-white/70 px-4 py-2 shadow-sm backdrop-blur">
                <span class="font-semibold text-slate-700">
                  <%= index + 1 %>.
                  <% if project %>
                    <%= link_to project.title, project_path(project), class: "underline decoration-dotted decoration-slate-300 hover:decoration-slate-600" %>
                  <% end %>
                </span>
                <span class="text-slate-500"><%= pluralize(entry[:devlogs_count], "devlog") %></span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-blue-50 via-cyan-50 to-emerald-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Hack Club Covered</p>
        <span
          class="text-5xl md:text-6xl font-black drop-shadow-sm"
          data-wrapped-target="counter"
          data-wrapped-counter-type="currency"
          data-wrapped-counter-value="<%= @wrapped.usd_spent_by_hack_club %>">
          $0
        </span>
        <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
          That's how much Hack Club spent on you this summer!
        </p>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-amber-50 via-rose-50 to-stone-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Biggest Shell Drop</p>
        <% if order.present? %>
          <% shop_item = order.shop_item %>
          <% if shop_item&.image&.attached? %>
            <%= image_tag shop_item.image.variant(resize_to_limit: [260, 260]), class: "h-48 w-48 rounded-2xl object-cover shadow-lg" %>
          <% end %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= shop_item&.name || "Mystery Reward" %>
          </h2>
          <div class="flex flex-col items-center gap-2 text-slate-600 text-balance">
            <div class="flex items-center gap-3 text-4xl font-bold text-slate-900">
              <%= image_tag "shell.png", width: 48, alt: "Shell icon", class: "w-10 h-10" %>
              <span
                data-wrapped-target="counter"
                data-wrapped-counter-type="shells"
                data-wrapped-counter-value="<%= @wrapped.most_expensive_order_total.to_i %>">
                0
              </span>
            </div>
            <p class="text-lg md:text-xl text-slate-600 text-balance">
              <%= pluralize(order.quantity, "item") %> in one legendary haul.
            </p>
          </div>
        <% else %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">No orders (yet!)</h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            Visit the shop when you spot something shiny - the next haul could land here!
          </p>
        <% end %>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-emerald-50 via-teal-50 to-blue-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Priciest Item</p>
        <% if item.present? %>
          <% if item.image&.attached? %>
            <%= image_tag item.image.variant(resize_to_limit: [260, 260]), class: "h-48 w-48 rounded-2xl object-cover shadow-lg" %>
          <% end %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= item.name %>
          </h2>
          <% if @wrapped.most_expensive_item_price %>
            <div class="flex items-center gap-3 text-3xl font-semibold text-slate-900">
              <%= image_tag "shell.png", width: 40, alt: "Shell icon", class: "w-9 h-9" %>
              <span
                data-wrapped-target="counter"
                data-wrapped-counter-type="shells"
                data-wrapped-counter-value="<%= @wrapped.most_expensive_item_price.to_i %>">
                0
              </span>
              <span class="text-xl text-slate-500">each</span>
            </div>
          <% else %>
            <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
              The price shifted after you grabbed it, but we know it was a splurge.
            </p>
          <% end %>
        <% else %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">No shop pickups</h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            really?
          </p>
        <% end %>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-purple-50 via-pink-50 to-rose-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Most Time Spent</p>
        <% if project_time.present? %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= link_to project_time.title, project_path(project_time), class: "underline decoration-dotted decoration-slate-400 hover:decoration-slate-600" %>
          </h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            You logged <span class="font-semibold"><%= format_seconds(project_time_seconds || 0, include_days: true) %></span> building this.
          </p>
        <% else %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">No project time yet</h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            someone hasn't been locking in...
          </p>
        <% end %>
      </div>

      <% if helper_slide %>
        <div
          class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-emerald-50 via-emerald-100 to-sky-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
          data-wrapped-target="slide">
          <p class="font-medium uppercase tracking-[0.35em] text-sm text-emerald-600 text-balance">Support Hero</p>
          <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm text-emerald-700">
            <span
              data-wrapped-target="counter"
              data-wrapped-counter-type="integer"
              data-wrapped-counter-value="<%= helper_tickets_closed %>">
              0
            </span>
            <span class="text-2xl font-semibold text-emerald-500">tickets closed</span>
          </div>
          <p class="text-lg md:text-xl max-w-2xl text-emerald-700/80 text-balance">
            awesome work clearing the queue!
          </p>
          <% if helper_tickets_opened && helper_tickets_opened.positive? %>
            <p class="text-base md:text-lg text-emerald-700/70 text-balance">
              handled across <%= number_with_delimiter(helper_tickets_opened) %> tickets opened.
            </p>
          <% end %>
        </div>
      <% end %>

      <% if has_shells_rank %>
        <div
          class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-amber-50 via-amber-100 to-lime-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
          data-wrapped-target="slide">
          <p class="font-medium uppercase tracking-[0.35em] text-sm text-amber-600 text-balance">Shell Leaderboard</p>
          <div class="flex flex-col items-center gap-4">
            <div class="text-5xl md:text-6xl font-black text-amber-700">
              #<span
                data-wrapped-target="counter"
                data-wrapped-counter-type="integer"
                data-wrapped-counter-value="<%= rank_value %>">
                0
              </span>
            </div>
            <p class="text-lg md:text-xl text-amber-800/80 text-balance max-w-2xl">
              You ranked <%= rank_value.ordinalize %> out of <%= number_with_delimiter(total_ranked) %> shell earners.
            </p>
          </div>
          <% if percentile %>
            <p class="text-base md:text-lg text-amber-700/70 text-balance">
              That’s the top <%= number_to_percentage(percentile, precision: 1) %> of the leaderboard.
            </p>
          <% else %>
            <p class="text-base md:text-lg text-amber-700/70 text-balance">
              Keep shipping—every shell you earn nudges you higher up the board.
            </p>
          <% end %>
        </div>
      <% end %>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-slate-200 via-slate-100 to-slate-300 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-600 text-balance">Shells Per Hour Champ</p>
        <% if project_ratio.present? && project_ratio_rate %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= link_to project_ratio.title, project_path(project_ratio), class: "underline decoration-dotted decoration-slate-400 hover:decoration-slate-700" %>
          </h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            <span class="font-semibold flex items-center justify-center gap-2 text-3xl text-slate-900">
              <%= image_tag "shell.png", width: 40, alt: "Shell icon", class: "w-9 h-9" %>
              <span
                data-wrapped-target="counter"
                data-wrapped-counter-type="decimal"
                data-wrapped-counter-precision="2"
                data-wrapped-counter-value="<%= project_ratio_rate %>">
                0.00
              </span>
              <span class="text-lg text-slate-500">shells/hour</span>
            </span>
            over <%= format_seconds((project_ratio_hours ? (project_ratio_hours * 3600).to_i : 0), include_days: true) %> of logged work.
          </p>
        <% elsif project_ratio.present? %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= project_ratio.title %>
          </h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            Keep logging time to unlock a shells-per-hour stat here.
          </p>
        <% else %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">No shell/hour data</h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            no ships? boring...
          </p>
        <% end %>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-slate-900 via-violet-900/80 to-slate-800 p-14 text-center text-white opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-white/70 text-balance">Wrapped Complete</p>
        <h2 class="text-4xl md:text-5xl font-black text-balance md:text-6xl">
          Thanks for making your summer count!
        </h2>
        <p class="text-lg md:text-xl max-w-2xl text-white/80 text-balance">
          We hope you had as much fun taking part as we did running it!
        </p>
        <div class="flex flex-col items-center gap-3 sm:flex-row sm:gap-4">
          <% if share_url.present? %>
            <button
              type="button"
              class="rounded-full bg-white px-5 py-2.5 text-sm font-semibold uppercase tracking-[0.2em] text-slate-900 shadow-lg transition hover:bg-slate-200"
              data-action="wrapped#shareWrapped">
              Share your wrapped
            </button>
          <% end %>
          <button
            type="button"
            class="rounded-full bg-slate-900/80 px-5 py-2.5 text-sm font-semibold uppercase tracking-[0.2em] text-white shadow-lg transition hover:bg-slate-700"
            data-action="wrapped#downloadBento"
            data-wrapped-target="downloadButton">
            Download bento grid
          </button>
        </div>
        <span class="hidden text-sm font-medium text-emerald-300" data-wrapped-target="shareFeedback">Link copied!</span>
      </div>
    </div>

    <div class="absolute inset-x-0 bottom-8 z-30 flex items-center justify-between px-10">
      <button
        class="rounded-full bg-black/20 text-white backdrop-blur px-4 py-3 hover:bg-black/40 transition"
        data-action="wrapped#previous">
        <span class="sr-only">Previous</span>
        &#8592;
      </button>
      <button
        class="rounded-full bg-black/20 text-white backdrop-blur px-4 py-3 hover:bg-black/40 transition"
        data-action="wrapped#next">
        <span class="sr-only">Next</span>
        &#8594;
      </button>
    </div>
  </div>

    <div class="hidden fixed -left-[9999px] top-0 z-[-1] w-full" data-wrapped-target="bento" aria-hidden="true">
      <div class="w-[1200px] rounded-3xl bg-slate-50 p-12 text-slate-900 shadow-2xl" data-wrapped-bento-root>
        <div class="grid grid-cols-12 gap-6">
          <div class="col-span-12 rounded-3xl bg-gradient-to-br from-violet-500 via-indigo-500 to-sky-500 p-10 text-white shadow-lg">
            <p class="text-xs font-semibold uppercase tracking-[0.35em] text-white/80">Summer of Making 2025</p>
            <h2 class="mt-4 text-5xl font-black"><%= display_name %>'s Wrapped</h2>
            <p class="mt-5 max-w-3xl text-lg text-white/85">
              Highlights from Hack Club’s Summer of Making — shells earned, ships shared, and community impact from <%= display_name %>.
            </p>
          </div>

          <div class="col-span-4 flex h-full flex-col justify-between rounded-3xl border border-slate-900/10 bg-white p-8 shadow-md">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500">Shells Earned</p>
              <p class="mt-4 text-5xl font-black text-slate-900"><%= number_with_delimiter(@wrapped.shells_earned) %></p>
              <div class="mt-6 space-y-2 text-sm text-slate-600">
                <p><span class="font-semibold text-slate-800">Spent:</span> <%= number_with_delimiter(@wrapped.shells_spent) %></p>
                <p><span class="font-semibold text-slate-800">Net:</span> <%= number_with_delimiter(@wrapped.net_shells) %></p>
              </div>
            </div>
            <% if has_shells_rank && total_ranked.to_i.positive? %>
              <p class="text-sm font-semibold text-slate-700">
                #<%= number_with_delimiter(rank_value) %> out of <%= number_with_delimiter(total_ranked) %> on the shell leaderboard.
              </p>
            <% else %>
              <p class="text-sm text-slate-500">
                Keep stacking shells to climb the leaderboard.
              </p>
            <% end %>
          </div>

          <div class="col-span-4 flex h-full flex-col justify-between rounded-3xl border border-slate-900/10 bg-white p-8 shadow-md">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500">Community Impact</p>
              <p class="mt-4 text-5xl font-black text-slate-900"><%= number_with_delimiter(votes_cast) %></p>
              <p class="mt-2 text-sm font-medium uppercase tracking-[0.2em] text-slate-500">Votes Cast</p>
            </div>
            <% if helper_slide && helper_tickets_closed %>
              <p class="text-sm text-slate-600">
                Closed <span class="font-semibold text-slate-800"><%= number_with_delimiter(helper_tickets_closed) %></span> help tickets for other hackers.
              </p>
            <% else %>
              <p class="text-sm text-slate-500">
                Show some love on ships to boost your community stats.
              </p>
            <% end %>
          </div>

          <div class="col-span-4 flex h-full flex-col justify-between rounded-3xl border border-slate-900/10 bg-white p-8 shadow-md">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500">Biggest Haul</p>
              <% if order.present? %>
                <% item_name = order.shop_item&.name || "Mystery Reward" %>
                <p class="mt-4 text-3xl font-black text-slate-900"><%= item_name %></p>
                <% quantity = order.quantity.to_i %>
                <p class="mt-4 text-sm text-slate-600">
                  <span class="font-semibold text-slate-800"><%= number_with_delimiter(quantity) %></span> item<%= "s" if quantity != 1 %> ·
                  <span class="font-semibold text-slate-800"><%= number_with_delimiter(@wrapped.most_expensive_order_total.to_i) %></span> shells
                </p>
              <% else %>
                <p class="mt-4 text-3xl font-black text-slate-900">No orders yet</p>
                <p class="mt-4 text-sm text-slate-600">
                  Spot something shiny in the shop to fill this card next time.
                </p>
              <% end %>
            </div>
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Hack Club Shop</p>
          </div>

          <div class="col-span-6 flex h-full flex-col justify-between rounded-3xl border border-slate-900/10 bg-white p-8 shadow-md">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500">Most Time Logged</p>
              <% if project_time.present? %>
                <p class="mt-4 text-3xl font-black text-slate-900"><%= project_time.title %></p>
                <p class="mt-4 text-sm text-slate-600">
                  <span class="font-semibold text-slate-800"><%= format_seconds(project_time_seconds || 0, include_days: true) %></span> poured into this build.
                </p>
              <% else %>
                <p class="mt-4 text-3xl font-black text-slate-900">No tracked time yet</p>
                <p class="mt-4 text-sm text-slate-600">
                  Log coding sessions with Hackatime to unlock this stat.
                </p>
              <% end %>
            </div>
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Hack Club Projects</p>
          </div>

          <div class="col-span-6 flex h-full flex-col justify-between rounded-3xl border border-slate-900/10 bg-white p-8 shadow-md">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500">Shell Efficiency</p>
              <% if project_ratio.present? && project_ratio_rate %>
                <p class="mt-4 text-4xl font-black text-slate-900"><%= number_with_precision(project_ratio_rate, precision: 2) %> shells/hour</p>
                <p class="mt-4 text-sm text-slate-600">
                  From <span class="font-semibold text-slate-800"><%= project_ratio.title %></span> over <%= format_seconds((project_ratio_hours ? (project_ratio_hours * 3600).to_i : 0), include_days: true) %>.
                </p>
              <% elsif project_ratio.present? %>
                <p class="mt-4 text-3xl font-black text-slate-900"><%= project_ratio.title %></p>
                <p class="mt-4 text-sm text-slate-600">
                  Log more time to unlock shells-per-hour insights.
                </p>
              <% else %>
                <p class="mt-4 text-3xl font-black text-slate-900">No payouts tracked yet</p>
                <p class="mt-4 text-sm text-slate-600">
                  Ship something and log payouts to populate this card.
                </p>
              <% end %>
            </div>
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Payouts & Time</p>
          </div>
        </div>
        <div class="mt-6 flex items-center justify-between text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">
          <span>summer.hackclub.com</span>
          <span>Generated <%= Time.zone.now.strftime("%b %-d, %Y") %></span>
        </div>
      </div>
    </div>
  </div>
</div>
