<% content_for :title, "Wrapped" %>
<% order = @wrapped.most_expensive_order %>
<% item = @wrapped.most_expensive_item %>
<% project_time = @wrapped.project_with_most_time %>
<% project_ratio = @wrapped.project_with_highest_shells_per_hour %>
<% project_time_seconds = @wrapped.project_total_seconds(project_time) %>
<% project_ratio_hours = @wrapped.project_total_hours(project_ratio) %>
<% project_ratio_rate = @wrapped.project_shells_per_hour(project_ratio) %>

<% helper_slide = @wrapped.helper_slide? %>
<% helper_tickets_closed = helper_slide ? @wrapped.helper_tickets_closed : nil %>
<% votes_cast = @wrapped.votes_cast %>
<% total_slides = 9 + (helper_slide ? 1 : 0) %>

<div class="min-h-[calc(100vh-8rem)] w-full flex flex-col items-center justify-center py-10 px-6">
  <div
    class="relative w-full max-w-5xl"
    data-controller="wrapped"
    data-wrapped-interval-value="8000">
    <div class="absolute top-6 right-6 left-6 z-20 flex gap-2">
      <% total_slides.times do %>
        <div class="h-1.5 w-full overflow-hidden rounded-full bg-slate-900/25 shadow-[inset_0_0_4px_rgba(15,23,42,0.35)]">
          <div class="h-full w-0 bg-slate-900 transition-[width] duration-[var(--wrapped-interval,8000ms)] shadow-sm" data-wrapped-target="progressBar"></div>
        </div>
      <% end %>
    </div>

    <div class="relative h-[560px] w-full overflow-hidden rounded-3xl shadow-2xl">
      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-slate-100 via-violet-100 to-sky-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.4em] text-sm text-slate-500 text-balance">Summer of Making 2025</p>
        <h1 class="text-5xl md:text-6xl font-black leading-tight text-balance">
          Hey <%= current_user.display_name %>, welcome to your Wrapped.
        </h1>
        <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
          We crunched your projects, shells and shop adventures into a mini highlight reel.
          Sit back and relax, or use your arrow keys to explore each page.
        </p>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-amber-50 via-orange-50 to-rose-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Shells Earned</p>
        <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm">
          <%= image_tag "shell.png", width: 64, alt: "Shell icon", class: "w-14 h-14" %>
          <span
            data-wrapped-target="counter"
            data-wrapped-counter-type="shells"
            data-wrapped-counter-value="<%= @wrapped.shells_earned %>">
            0
          </span>
        </div>
        <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
          Those are the shells you pulled in from your ships this summer.
        </p>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-rose-50 via-red-50 to-amber-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Shells Spent</p>
        <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm">
          <%= image_tag "shell.png", width: 64, alt: "Shell icon", class: "w-14 h-14" %>
          <span
            data-wrapped-target="counter"
            data-wrapped-counter-type="shells"
            data-wrapped-counter-value="<%= @wrapped.shells_spent %>">
            0
          </span>
        </div>
        <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            You re-invested your winnings into gear and goodies worth every <span class="ml-2 line-through text-sm text-slate-500">penny</span> shell.
        </p>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-indigo-50 via-violet-50 to-slate-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Votes Cast</p>
        <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm text-slate-800">
          <span
            data-wrapped-target="counter"
            data-wrapped-counter-type="integer"
            data-wrapped-counter-value="<%= votes_cast %>">
            0
          </span>
          <span class="text-2xl font-semibold text-slate-500">votes</span>
        </div>
        <% if votes_cast.positive? %>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            were they <i>good</i> votes though? that's the question...
          </p>
        <% else %>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            you cannot be serious
          </p>
        <% end %>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-blue-50 via-cyan-50 to-emerald-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Hack Club Covered</p>
        <span
          class="text-5xl md:text-6xl font-black drop-shadow-sm"
          data-wrapped-target="counter"
          data-wrapped-counter-type="currency"
          data-wrapped-counter-value="<%= @wrapped.usd_spent_by_hack_club %>">
          $0
        </span>
        <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
          That's how much Hack Club spent on you this summer!
        </p>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-amber-50 via-rose-50 to-stone-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Biggest Shell Drop</p>
        <% if order.present? %>
          <% shop_item = order.shop_item %>
          <% if shop_item&.image&.attached? %>
            <%= image_tag shop_item.image.variant(resize_to_limit: [260, 260]), class: "h-48 w-48 rounded-2xl object-cover shadow-lg" %>
          <% end %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= shop_item&.name || "Mystery Reward" %>
          </h2>
          <div class="flex flex-col items-center gap-2 text-slate-600 text-balance">
            <div class="flex items-center gap-3 text-4xl font-bold text-slate-900">
              <%= image_tag "shell.png", width: 48, alt: "Shell icon", class: "w-10 h-10" %>
              <span
                data-wrapped-target="counter"
                data-wrapped-counter-type="shells"
                data-wrapped-counter-value="<%= @wrapped.most_expensive_order_total.to_i %>">
                0
              </span>
            </div>
            <p class="text-lg md:text-xl text-slate-600 text-balance">
              <%= pluralize(order.quantity, "item") %> in one legendary haul.
            </p>
          </div>
        <% else %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">No orders (yet!)</h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            Visit the shop when you spot something shiny - the next haul could land here!
          </p>
        <% end %>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-emerald-50 via-teal-50 to-blue-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Priciest Item</p>
        <% if item.present? %>
          <% if item.image&.attached? %>
            <%= image_tag item.image.variant(resize_to_limit: [260, 260]), class: "h-48 w-48 rounded-2xl object-cover shadow-lg" %>
          <% end %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= item.name %>
          </h2>
          <% if @wrapped.most_expensive_item_price %>
            <div class="flex items-center gap-3 text-3xl font-semibold text-slate-900">
              <%= image_tag "shell.png", width: 40, alt: "Shell icon", class: "w-9 h-9" %>
              <span
                data-wrapped-target="counter"
                data-wrapped-counter-type="shells"
                data-wrapped-counter-value="<%= @wrapped.most_expensive_item_price.to_i %>">
                0
              </span>
              <span class="text-xl text-slate-500">each</span>
            </div>
          <% else %>
            <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
              The price shifted after you grabbed it, but we know it was a splurge.
            </p>
          <% end %>
        <% else %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">No shop pickups</h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            really?
          </p>
        <% end %>
      </div>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-purple-50 via-pink-50 to-rose-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-500 text-balance">Most Time Spent</p>
        <% if project_time.present? %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= link_to project_time.title, project_path(project_time), class: "underline decoration-dotted decoration-slate-400 hover:decoration-slate-600" %>
          </h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            You logged <span class="font-semibold"><%= format_seconds(project_time_seconds || 0, include_days: true) %></span> building this.
          </p>
        <% else %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">No project time yet</h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            someone hasn't been locking in...
          </p>
        <% end %>
      </div>

      <% if helper_slide %>
        <div
          class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-emerald-50 via-emerald-100 to-sky-100 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
          data-wrapped-target="slide">
          <p class="font-medium uppercase tracking-[0.35em] text-sm text-emerald-600 text-balance">Support Hero</p>
          <div class="flex items-center gap-4 text-6xl md:text-7xl font-black drop-shadow-sm text-emerald-700">
            <span
              data-wrapped-target="counter"
              data-wrapped-counter-type="integer"
              data-wrapped-counter-value="<%= helper_tickets_closed %>">
              0
            </span>
            <span class="text-2xl font-semibold text-emerald-500">tickets closed</span>
          </div>
          <p class="text-lg md:text-xl max-w-2xl text-emerald-700/80 text-balance">
            awesome work clearing the queue!
          </p>
        </div>
      <% end %>

      <div
        class="absolute inset-0 flex flex-col items-center justify-center gap-6 bg-gradient-to-br from-slate-200 via-slate-100 to-slate-300 p-14 text-center text-slate-900 opacity-0 pointer-events-none scale-95 transition-all duration-700 ease-out"
        data-wrapped-target="slide">
        <p class="font-medium uppercase tracking-[0.35em] text-sm text-slate-600 text-balance">Shells Per Hour Champ</p>
        <% if project_ratio.present? && project_ratio_rate %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= link_to project_ratio.title, project_path(project_ratio), class: "underline decoration-dotted decoration-slate-400 hover:decoration-slate-700" %>
          </h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            <span class="font-semibold flex items-center justify-center gap-2 text-3xl text-slate-900">
              <%= image_tag "shell.png", width: 40, alt: "Shell icon", class: "w-9 h-9" %>
              <span
                data-wrapped-target="counter"
                data-wrapped-counter-type="decimal"
                data-wrapped-counter-precision="2"
                data-wrapped-counter-value="<%= project_ratio_rate %>">
                0.00
              </span>
              <span class="text-lg text-slate-500">shells/hour</span>
            </span>
            over <%= format_seconds((project_ratio_hours ? (project_ratio_hours * 3600).to_i : 0), include_days: true) %> of logged work.
          </p>
        <% elsif project_ratio.present? %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">
            <%= project_ratio.title %>
          </h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            Keep logging time to unlock a shells-per-hour stat here.
          </p>
        <% else %>
          <h2 class="text-4xl md:text-5xl font-black text-balance">No shell/hour data</h2>
          <p class="text-lg md:text-xl max-w-2xl text-slate-600 text-balance">
            no ships? boring...
          </p>
        <% end %>
      </div>
    </div>

    <div class="absolute inset-x-0 bottom-8 z-30 flex items-center justify-between px-10">
      <button
        class="rounded-full bg-black/20 text-white backdrop-blur px-4 py-3 hover:bg-black/40 transition"
        data-action="wrapped#previous">
        <span class="sr-only">Previous</span>
        &#8592;
      </button>
      <button
        class="rounded-full bg-black/20 text-white backdrop-blur px-4 py-3 hover:bg-black/40 transition"
        data-action="wrapped#next">
        <span class="sr-only">Next</span>
        &#8594;
      </button>
    </div>
  </div>
</div>
