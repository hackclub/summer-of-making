<h1>Shop Items</h1>

<%= link_to "New Shop Item", new_admin_shop_item_path, class: "btn btn-primary" %>

<table class="table">
  <thead>
    <tr>
      <th>Image</th>
      <th>Name</th>
      <th>Type</th>
      <th>Ticket Cost</th>
      <th>USD Cost</th>
      <th>Stock</th>
      <th>Black Market</th>
      <th>Carousel</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @shop_items.each do |shop_item| %>
      <tr>
        <td>
          <% if shop_item.image.attached? %>
            <%= image_tag shop_item.image.variant(:thumb), width: 50, height: 50 %>
          <% else %>
            <span class="text-muted">No image</span>
          <% end %>
        </td>
        <td>
          <%= link_to shop_item.name, [:admin, shop_item.becomes(ShopItem)] %>
          <% if shop_item.internal_description.present? %>
            <br><small class="text-muted"><%= shop_item.internal_description %></small>
          <% end %>
        </td>
        <td><%= shop_item.type&.demodulize || "ShopItem" %></td>
        <td><%= shop_item.ticket_cost %></td>
        <td><%= shop_item.usd_cost %></td>
        <td>
          <% if shop_item.limited? %>
            <% remaining = shop_item.remaining_stock %>
            <span class="badge <%= remaining && remaining > 0 ? 'bg-success' : 'bg-danger' %>">
              <%= remaining || shop_item.stock || 0 %> left
            </span>
          <% else %>
            <span class="text-muted">Unlimited</span>
          <% end %>
        </td>
        <td>
          <% if shop_item.requires_black_market %>
            <span class="badge bg-dark">Black Market</span>
          <% end %>
        </td>
        <td>
          <% if shop_item.show_in_carousel %>
            <span class="badge bg-info">Carousel</span>
          <% end %>
        </td>
        <td>
          <%= link_to "Edit", [:edit, :admin, shop_item.becomes(ShopItem)], class: "btn btn-sm btn-outline-primary" %>
          <%= link_to "Delete",
                      [:admin, shop_item.becomes(ShopItem)],
                      method: :delete,
                      data: { confirm: "Are you sure?" },
                      class: "btn btn-sm btn-outline-danger" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%== pagy_nav(@pagy) if respond_to?(:pagy_nav) %>
<%== pagy_info(@pagy) if respond_to?(:pagy_info) %>

<%= link_to "← back", admin_root_path %>
