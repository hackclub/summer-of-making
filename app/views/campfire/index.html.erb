<div class="md:px-8">
    <%= render "shared/page_title",
        title: "Campfire",
        subtitle: "Huddle around! Get your news here." %>

    <!-- Hackatime Dashboard Section -->
  <% if @account_status[:hackatime_setup] && @hackatime_dashboard.present? %>
    <div class="mb-8">
      <div class="bg-white rounded-xl overflow-hidden">
        <div class="bg-white border-b px-6 py-4">
          <div class="flex items-center gap-3">
            <div class="flex-shrink-0">
              <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                <%= inline_svg "icons/time_fill.svg", class: "w-6 h-6 text-white" %>
              </div>
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-bold text-gray-900">
                <a href="https://hackatime.hackclub.com/" target="_blank" class="hover:text-blue-600 transition-all duration-200 flex items-center gap-2">
                  Hackatime
                  <%= inline_svg "icons/external_link_line.svg", class: "w-4 h-4 text-gray-400" %>
                </a>
              </h3>
            </div>
          </div>
        </div>

        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-xl p-6">
              <div class="flex items-center justify-between mb-3">
                <div class="w-12 h-12 bg-[#51A373] rounded-lg flex items-center justify-center">
                  <%= inline_svg "icons/chart_bar_fill.svg", class: "w-6 h-6 text-white" %>
                </div>
              </div>
              <div class="text-3xl font-bold text-gray-900 mb-1">
                <%= current_user.format_seconds(@hackatime_dashboard[:today_time]) %>
              </div>
              <div class="text-sm font-medium text-gray-600">Today's Coding Time</div>
            </div>

            <div class="bg-white rounded-xl p-6">
              <div class="flex items-center justify-between mb-3">
                <div class="w-12 h-12 bg-[#523A52] rounded-lg flex items-center justify-center">
                  <%= inline_svg "icons/chart_pie_2_fill.svg", class: "w-6 h-6 text-white" %>
                </div>
              </div>
              <div class="text-3xl font-bold text-gray-900 mb-1">
                <%= current_user.format_seconds(@hackatime_dashboard[:total_time]) %>
              </div>
              <div class="text-sm font-medium text-gray-600">Total Coding Time</div>
            </div>
          </div>
          
          <% unless @hackatime_dashboard[:has_time_recorded] %>
            <div class="mt-6 bg-amber-50 border border-amber-200 rounded-xl p-4">
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0">
                  <div class="w-10 h-10 bg-amber-500 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                </div>
                <div class="flex-1">
                  <h4 class="text-sm font-semibold text-amber-800 mb-1">Get Started with Time Tracking</h4>
                  <p class="text-sm text-amber-700 leading-relaxed">
                    No time recorded yet! Install Hackatime on at least one code editor, then start coding for a few minutes to see your stats here. 
                    <span class="font-medium">Every hour of coding = 1 shell</span>
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <% if !current_user.tutorial_progress.completed? %>
    <!-- Set up your account! Section -->
    <div class="mb-4">
      <h2 class="text-2xl text-gray-900 mb-4">Set up your account!</h2>
      <p class="text-gray-600 mb-4 text-xl font-semibold">Complete these steps to start earning shells, get free stickers, and unlock access to the rest of the platform!</p>

      <div class="space-y-4">
        <!-- Step 1: Hackatime -->
        <div class="bg-white rounded-lg border p-6"
             data-step="hackatime"
             data-controller="hackatime-status"
             data-hackatime-status-tutorial-active-value="<%= !current_user.tutorial_progress.completed? %>">
          <div class="flex items-start gap-4 mb-2">
            <div class="flex-shrink-0">
              <% if @account_status[:hackatime_projects] %>
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center" data-hackatime-status-target="icon">
                  <%= inline_svg "icons/check_fill.svg", class: "w-5 h-5" %>
                </div>
              <% elsif @account_status[:hackatime_setup] %>
                <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center" data-hackatime-status-target="icon">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5" %>
                </div>
              <% elsif @account_status[:hackatime_linked] %>
                <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center" data-hackatime-status-target="icon">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5" %>
                </div>
              <% else %>
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center" data-hackatime-status-target="icon">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5" %>
                </div>
              <% end %>
            </div>
            <h3 class="text-lg font-semibold text-gray-900">Install Hackatime</h3>
          </div>

          <div class="flex-1 md:ml-12">
            <p class="text-gray-600 mb-4">
              Hackatime is an open-source tool which automatically tracks your coding time. <br class="hidden lg:block">1 hour = 1 shell<image src="/inlineshell.png" class="w-5 h-5 inline-block"></image>, with up to 30x bonuses based on community votes!
              <br><br>
              Make sure <span class="text-[#E65A42]">all your code editors</span> are connected to Hackatime. You canâ€™t get shells without it!
            </p>
            <% if @account_status[:hackatime_projects] %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800" data-hackatime-status-target="status">
                Hackatime is installed
              </span>
            <% elsif @account_status[:hackatime_setup] %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-800" data-hackatime-status-target="status">
                Waiting for data from your code editor...
              </span>
            <% elsif @account_status[:hackatime_linked] %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-800" data-hackatime-status-target="status">
                Waiting for connection from Hackatime...
              </span>
            <% else %>
              <%= link_to "Connect Hackatime", hackatime_auth_redirect_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
            <% end %>
          </div>
        </div>

        <!-- Step 2: Identity Verification -->
        <div class="bg-white rounded-lg border p-6">
          <div class="flex items-start gap-4 mb-2">
            <div class="flex-shrink-0">
              <% if current_verification_status == :verified %>
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                  <%= inline_svg "icons/check_fill.svg", class: "w-5 h-5 text-green-600" %>
                </div>
              <% else %>
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5 text-blue-600" %>
                </div>
              <% end %>
            </div>
            <h3 class="text-lg font-semibold text-gray-900">Verify Your Age</h3>
          </div>

          <div class="flex-1 md:ml-12">
            <p class="text-gray-600 mb-4">Hack Club is for people 18 and under, so we need verify your age before the rest of the platform unlocks!</p>

            <% case current_verification_status %>
            <% when :not_linked %>
              <%= link_to "Start Verification", link_identity_vault_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
            <% when :needs_resubmission %>
              <div class="space-y-2">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-800">
                  Needs Submission
                </span>
                <%= link_to "Submit Documents", "https://idv-staging.a.hackclub.dev/", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ml-2", target: "_blank" %>
              </div>
            <% when :pending %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800">
                Pending Review
              </span>
            <% when :ineligible %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-red-100 text-red-800">
                Ineligible
              </span>
            <% else %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                Verified
              </span>
            <% end %>
          </div>
        </div>

        <!-- Step 3: Order free stickers -->
        <div class="bg-white rounded-lg border p-6">
          <div class="flex items-start gap-4 mb-2">
            <div class="flex-shrink-0">
              <% if current_user.shop_orders.joins(:shop_item).where(shop_items: { type: "ShopItem::FreeStickers" }).exists? %>
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                  <%= inline_svg "icons/check_fill.svg", class: "w-5 h-5 text-green-600" %>
                </div>
              <% else %>
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5 text-blue-600" %>
                </div>
              <% end %>
            </div>
            <h3 class="text-lg font-semibold text-gray-900">Order Free Stickers</h3>
          </div>

          <div class="flex-1 md:ml-12">
            <p class="text-gray-600 mb-4">Now for the best partâ€¦ getting free stuff! Order some stickers to get oriented with the shop.</p>
            <% if current_user.shop_orders.joins(:shop_item).where(shop_items: { type: "ShopItem::FreeStickers" }).exists? %>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                Ordered
              </span>
            <% else %>
              <%= link_to "Order Stickers", shop_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if current_user.tutorial_progress.completed? && !current_user.tutorial_video_seen? %>
    <!-- Video Tutorial Section -->
    <div class="mb-8">
      <div class="bg-white rounded-lg border-2 border-blue-200 p-6">
        <!-- Video Placeholder -->
        <div class="bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 p-12 mb-6">
          <div class="text-center">
            <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8 5v10l8-5-8-5z" />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">SoM Tutorial Video</h3>
            <p class="text-gray-500">ask-a-pixi for video!!</p>
          </div>
        </div>
        <div class="flex justify-center space-x-4">
          <%= link_to "Next",
                      campfire_path(mark_video_seen: true),
                      method: :patch,
                      class: "px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium shadow-lg" %>
        </div>
      </div>
    </div>
  <% end %>

  <% if current_user.tutorial_progress.completed? && current_user.tutorial_video_seen? %>
    <!-- Account Status Section -->
    <% if current_verification_status == :not_linked || current_verification_status == :needs_resubmission || current_verification_status == :pending || current_verification_status == :ineligible || !@account_status[:hackatime_projects] %>
    <div class="mb-8">
      <h2 class="text-xl  text-gray-900 mb-4">Account Status</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

        <!-- Hackatime Status Card -->
        <% if !@account_status[:hackatime_projects] %>
        <div class="bg-white rounded-lg border p-4">
          <div class="flex items-center justify-between">
            <div>
              <h3 class=" text-gray-900">Hackatime</h3>
            </div>
            <% if @account_status[:hackatime_setup] %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800">
                Waiting for project data....
              </span>
            <% elsif @account_status[:hackatime_linked] %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800">
                Waiting for test data...
              </span>
            <% else %>
              <div class="flex flex-col items-end space-y-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs bg-red-100 text-red-800">
                  Not Connected
                </span>
                <%= link_to "Connect", hackatime_auth_redirect_path, class: "inline-flex items-center px-3 py-1 border border-transparent text-xs rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
              </div>
            <% end %>
          </div>
        </div>
        <% end %>

        <% if current_verification_status != :verified %>
        <div class="bg-white rounded-lg border p-4">
          <div class="flex items-center justify-between">
            <div>
              <h3 class=" text-gray-900">Identity Verification</h3>
            </div>
            <% case current_verification_status %>
            <% when :not_linked %>
              <div class="flex flex-col items-end space-y-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs  bg-red-100 text-red-800">
                  Not Started
                </span>
                <%= link_to "Verify", link_identity_vault_path, class: "inline-flex items-center px-3 py-1 border border-transparent text-xs  rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
              </div>
            <% when :needs_resubmission %>
              <div class="flex flex-col items-end space-y-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs  bg-yellow-100 text-yellow-800">
                  Needs Submission
                </span>
                <%= link_to "Submit", "https://idv-staging.a.hackclub.dev/", class: "inline-flex items-center px-3 py-1 border border-transparent text-xs  rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
              </div>
            <% when :pending %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs  bg-blue-100 text-blue-800">
                Pending Review
              </span>
            <% when :ineligible %>
              <div class="flex flex-col items-end space-y-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs  bg-red-100 text-red-800">
                  Ineligible
                </span>
              </div>
            <% end %>
          </div>
        </div>
        <% end %>
      </div>
    </div>
    <% end %>

    <!-- Announcements Section -->
    <% if @announcements.any? %>
    <div class="mb-8">
      <h2 class="text-xl  text-gray-900 mb-4">Announcements</h2>
      <div class="space-y-4">
        <% @announcements.each do |announcement| %>
          <div class="bg-white rounded-lg border p-4">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center mb-2">
                  <h3 class=" text-gray-900 mr-2"><%= announcement[:title] %></h3>
                  <% case announcement[:type] %>
                  <% when 'info' %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs  bg-blue-100 text-blue-800">
                      Info
                    </span>
                  <% when 'warning' %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs  bg-yellow-100 text-yellow-800">
                      Important
                    </span>
                  <% end %>
                </div>
                <p class="text-gray-600 mb-2 font-national-park font-bold tracking-tight"><%= announcement[:content] %></p>
                <p class="text-sm text-gray-400 font-national-park font-bold tracking-tight">
                  <%= time_ago_in_words(announcement[:created_at]) %> ago
                </p>
              </div>
              <% if announcement[:action_url] %>
                <a href="<%= announcement[:action_url] %>"
                   class="ml-4 inline-flex items-center px-3 py-1 border border-transparent text-sm  rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  Take Action
                </a>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <% end %>

    <!--Tutorial Video -->
    <div class="mb-8">
      <div class="bg-white rounded-lg border p-4">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-gray-900">Tutorial Video</h2>
        </div>

        <div id="tutorial-video-content">
          <div class="bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 p-8 mb-4">
            <div class="text-center">
              <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M8 5v10l8-5-8-5z" />
                </svg>
              </div>
              <h3 class="text-lg font-semibold text-gray-700 mb-2">SoM Tutorial Video</h3>
              <p class="text-gray-500">Ask-a-pixi for video!!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="mb-8">
    <div class="bg-white rounded-lg border p-6">
      <div class="flex items-start gap-4 mb-2">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-600" viewBox="0 0 24 24">
              <path fill="currentColor" d="M11.95 18q.525 0 .888-.363t.362-.887q0-.525-.362-.888t-.888-.362q-.525 0-.887.363t-.363.887q0 .525.363.888t.887.362m-.9-3.85h1.85q0-.825.188-1.3t1.062-1.3q.65-.65 1.025-1.238T15.55 8.9q0-1.4-1.025-2.15T12.1 6q-1.425 0-2.313.75T8.55 8.55l1.65.65q.125-.45.563-.975T12.1 7.7q.8 0 1.2.438t.4.962q0 .5-.3.938t-.75.812q-1.1.975-1.35 1.475t-.25 1.825M12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22" />
            </svg>
          </div>
        </div>
        <h3 class="text-lg font-semibold text-gray-900">Need Help?</h3>
      </div>

      <div class="flex-1 md:ml-12">
        <p class="text-gray-600 mb-4">
          Need some help? Got a question?
          Post it in the
          <a href="https://hackclub.slack.com/archives/C090JKDJYN8" target="_blank" class="text-blue-600 hover:text-blue-700">#summer-of-making-help</a>
          channel!
        </p>
      </div>
    </div>
  </div>
</div>
