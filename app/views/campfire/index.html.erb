<div class="px-4 md:px-8">
    <%= render "shared/page_title",
        title: "Campfire",
        subtitle: "Huddle around! Get your news here." %>

  <% if !current_user.tutorial_progress.completed? %>
    <!-- Set up your account! Section -->
    <div class="mb-8">
      <h2 class="text-2xl text-gray-900 mb-4">Set up your account!</h2>
      <p class="text-gray-600 mb-4 text-xl font-semibold">Complete these steps to start earning shells and get free stickers in the process! The platform is <span class="text-black font-bold">limited</span> while you set up your account.</p>

      <div class="space-y-4">
        <!-- Step 1: Hackatime -->
        <div class="bg-white rounded-lg border p-6"
             data-step="hackatime"
             data-controller="hackatime-status"
             data-hackatime-status-tutorial-active-value="<%= !current_user.tutorial_progress.completed? %>">
          <div class="flex items-start space-x-4">
            <div class="flex-shrink-0">
              <% if @account_status[:hackatime_projects] %>
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center" data-hackatime-status-target="icon">
                  <%= inline_svg "icons/check_fill.svg", class: "w-5 h-5" %>
                </div>
              <% elsif @account_status[:hackatime_setup] %>
                <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center" data-hackatime-status-target="icon">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5" %>
                </div>
              <% elsif @account_status[:hackatime_linked] %>
                <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center" data-hackatime-status-target="icon">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5" %>
                </div>
              <% else %>
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center" data-hackatime-status-target="icon">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5" %>
                </div>
              <% end %>
            </div>
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-gray-900 mb-2">Connect your Hackatime account</h3>
              <p class="text-gray-600 mb-4">Hackatime tracks how much you code, and we use that time to give you shells as a reward for all your hard work!</p>
              <% if @account_status[:hackatime_projects] %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800" data-hackatime-status-target="status">
                  Linked and projects tracked!
                </span>
              <% elsif @account_status[:hackatime_setup] %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-800" data-hackatime-status-target="status">
                  Linked, now waiting for real data...
                </span>
              <% elsif @account_status[:hackatime_linked] %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-800" data-hackatime-status-target="status">
                  Waiting for test data...
                </span>
              <% else %>
                <%= link_to "Connect Hackatime", hackatime_auth_redirect_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Step 2: Identity Verification -->
        <div class="bg-white rounded-lg border p-6">
          <div class="flex items-start space-x-4">
            <div class="flex-shrink-0">
              <% if current_verification_status == :verified %>
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                  <%= inline_svg "icons/check_fill.svg", class: "w-5 h-5 text-green-600" %>
                </div>
              <% else %>
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5 text-blue-600" %>
                </div>
              <% end %>
            </div>
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-gray-900 mb-2">Verify your identity</h3>
              <p class="text-gray-600 mb-4">Hack Club is for people 18 and under, so we'll need to check that you're eligible before we can send you any of the cool stuff we've got</p>

              <% case current_verification_status %>
              <% when :not_linked %>
                <%= link_to "Start Verification", link_identity_vault_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
              <% when :needs_resubmission %>
                <div class="space-y-2">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-800">
                    Needs Submission
                  </span>
                  <%= link_to "Submit Documents", "https://idv-staging.a.hackclub.dev/", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ml-2", target: "_blank" %>
                </div>
              <% when :pending %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800">
                  Pending Review
                </span>
              <% when :ineligible %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-red-100 text-red-800">
                  Ineligible
                </span>
              <% else %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                  Verified
                </span>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Step 3: Order free stickers -->
        <div class="bg-white rounded-lg border p-6">
          <div class="flex items-start space-x-4">
            <div class="flex-shrink-0">
              <% if current_user.shop_orders.joins(:shop_item).where(shop_items: { type: "ShopItem::FreeStickers" }).exists? %>
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                  <%= inline_svg "icons/check_fill.svg", class: "w-5 h-5 text-green-600" %>
                </div>
              <% else %>
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <%= inline_svg "icons/to_do_fill.svg", class: "w-5 h-5 text-blue-600" %>
                </div>
              <% end %>
            </div>
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-gray-900 mb-2">Order your free stickers</h3>
              <p class="text-gray-600 mb-4">Well, now you have linked your Hackatime account, and verified your identity soo maybe.... order your free stickers!!!</p>
              <% if current_user.shop_orders.joins(:shop_item).where(shop_items: { type: "ShopItem::FreeStickers" }).exists? %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                  Ordered
                </span>
              <% else %>
                <%= link_to "Order Stickers", shop_path, class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if current_user.tutorial_progress.completed? && !current_user.tutorial_video_seen? %>
    <!-- Video Tutorial Section -->
    <div class="mb-8">
      <div class="bg-white rounded-lg border-2 border-blue-200 p-6">
        <!-- Video Placeholder -->
        <div class="bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 p-12 mb-6">
          <div class="text-center">
            <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8 5v10l8-5-8-5z" />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">SoM Tutorial Video</h3>
            <p class="text-gray-500">ask-a-pixi for video!!</p>
          </div>
        </div>
        <div class="flex justify-center space-x-4">
          <%= link_to "Next",
                      campfire_path(mark_video_seen: true),
                      method: :patch,
                      class: "px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium shadow-lg" %>
        </div>
      </div>
    </div>
  <% end %>

  <% if current_user.tutorial_progress.completed? && current_user.tutorial_video_seen? %>
    <!-- Account Status Section -->
    <% if current_verification_status == :not_linked || current_verification_status == :needs_resubmission || current_verification_status == :pending || current_verification_status == :ineligible || !@account_status[:hackatime_projects] %>
    <div class="mb-8">
      <h2 class="text-xl  text-gray-900 mb-4">Account Status</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

        <!-- Hackatime Status Card -->
        <% if !@account_status[:hackatime_projects] %>
        <div class="bg-white rounded-lg border p-4">
          <div class="flex items-center justify-between">
            <div>
              <h3 class=" text-gray-900">Hackatime</h3>
            </div>
            <% if @account_status[:hackatime_setup] %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800">
                Waiting for project data....
              </span>
            <% elsif @account_status[:hackatime_linked] %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800">
                Waiting for test data...
              </span>
            <% else %>
              <div class="flex flex-col items-end space-y-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs bg-red-100 text-red-800">
                  Not Connected
                </span>
                <%= link_to "Connect", hackatime_auth_redirect_path, class: "inline-flex items-center px-3 py-1 border border-transparent text-xs rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
              </div>
            <% end %>
          </div>
        </div>
        <% end %>

        <% if current_verification_status != :verified %>
        <div class="bg-white rounded-lg border p-4">
          <div class="flex items-center justify-between">
            <div>
              <h3 class=" text-gray-900">Identity Verification</h3>
            </div>
            <% case current_verification_status %>
            <% when :not_linked %>
              <div class="flex flex-col items-end space-y-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs  bg-red-100 text-red-800">
                  Not Started
                </span>
                <%= link_to "Verify", link_identity_vault_path, class: "inline-flex items-center px-3 py-1 border border-transparent text-xs  rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
              </div>
            <% when :needs_resubmission %>
              <div class="flex flex-col items-end space-y-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs  bg-yellow-100 text-yellow-800">
                  Needs Submission
                </span>
                <%= link_to "Submit", "https://idv-staging.a.hackclub.dev/", class: "inline-flex items-center px-3 py-1 border border-transparent text-xs  rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", target: "_blank" %>
              </div>
            <% when :pending %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs  bg-blue-100 text-blue-800">
                Pending Review
              </span>
            <% when :ineligible %>
              <div class="flex flex-col items-end space-y-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs  bg-red-100 text-red-800">
                  Ineligible
                </span>
              </div>
            <% end %>
          </div>
        </div>
        <% end %>
      </div>
    </div>
    <% end %>

    <!-- Announcements Section -->
    <% if @announcements.any? %>
    <div class="mb-8">
      <h2 class="text-xl  text-gray-900 mb-4">Announcements</h2>
      <div class="space-y-4">
        <% @announcements.each do |announcement| %>
          <div class="bg-white rounded-lg border p-4">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center mb-2">
                  <h3 class=" text-gray-900 mr-2"><%= announcement[:title] %></h3>
                  <% case announcement[:type] %>
                  <% when 'info' %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs  bg-blue-100 text-blue-800">
                      Info
                    </span>
                  <% when 'warning' %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs  bg-yellow-100 text-yellow-800">
                      Important
                    </span>
                  <% end %>
                </div>
                <p class="text-gray-600 mb-2 font-national-park font-bold tracking-tight"><%= announcement[:content] %></p>
                <p class="text-sm text-gray-400 font-national-park font-bold tracking-tight">
                  <%= time_ago_in_words(announcement[:created_at]) %> ago
                </p>
              </div>
              <% if announcement[:action_url] %>
                <a href="<%= announcement[:action_url] %>"
                   class="ml-4 inline-flex items-center px-3 py-1 border border-transparent text-sm  rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  Take Action
                </a>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <% end %>

    <!--Tutorial Video -->
    <div class="mb-8">
      <div class="bg-white rounded-lg border p-4">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-gray-900">Tutorial Video</h2>
        </div>

        <div id="tutorial-video-content">
          <div class="bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 p-8 mb-4">
            <div class="text-center">
              <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M8 5v10l8-5-8-5z" />
                </svg>
              </div>
              <h3 class="text-lg font-semibold text-gray-700 mb-2">SoM Tutorial Video</h3>
              <p class="text-gray-500">Ask-a-pixi for video!!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="mb-8">
    <div class="bg-white rounded-lg border p-6">
      <div class="flex items-start space-x-4">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-600" viewBox="0 0 24 24">
              <path fill="currentColor" d="M11.95 18q.525 0 .888-.363t.362-.887q0-.525-.362-.888t-.888-.362q-.525 0-.887.363t-.363.887q0 .525.363.888t.887.362m-.9-3.85h1.85q0-.825.188-1.3t1.062-1.3q.65-.65 1.025-1.238T15.55 8.9q0-1.4-1.025-2.15T12.1 6q-1.425 0-2.313.75T8.55 8.55l1.65.65q.125-.45.563-.975T12.1 7.7q.8 0 1.2.438t.4.962q0 .5-.3.938t-.75.812q-1.1.975-1.35 1.475t-.25 1.825M12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22" />
            </svg>
          </div>
        </div>
        <div class="flex-1">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Need Help?</h3>
          <p class="text-gray-600 mb-4">Got questions or running into issues? The #summer-help channel is the perfect place to get support from the community!</p>
          <a href="https://hackclub.slack.com/archives/C090JKDJYN8"
             target="_blank"
             class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24">
              <path fill="currentColor" d="M6 14q-.825 0-1.413-.588T4 12q0-.825.588-1.413T6 10q.825 0 1.413.588T8 12q0 .825-.588 1.413T6 14m4-8q-.825 0-1.413-.588T8 4q0-.825.588-1.413T10 2q.825 0 1.413.588T12 4q0 .825-.588 1.413T10 6m4 8q-.825 0-1.413-.588T12 12q0-.825.588-1.413T14 10q.825 0 1.413.588T16 12q0 .825-.588 1.413T14 14m4-8q-.825 0-1.413-.588T16 4q0-.825.588-1.413T18 2q.825 0 1.413.588T20 4q0 .825-.588 1.413T18 6" />
            </svg>
            Join #summer-help
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
