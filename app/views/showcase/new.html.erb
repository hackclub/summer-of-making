<div class="container mx-auto px-0 sm:px-4 py-4 md:py-8">
  <%= render "shared/page_title", title: "Showcase", subtitle: "The new vote thing" %>

  <!-- Two Column Layout -->
  <div class="grid grid-cols-1 lg:grid-cols-[3fr_2fr] gap-6 max-w-full">

    <!-- LHS -->
    <div class="space-y-6">
      <div class="sticky top-4 z-10 bg-[#F6DBBA] rounded-xl p-4 z-100 ">
        <div class="flex items-start gap-4">
          <div class="h-20 w-20 flex-shrink-0">
            <%= image_tag @project.banner, alt: @project.title, class: "w-full h-full object-cover rounded-lg", loading: "lazy" %>
          </div>
          <div class="flex-grow min-w-0">
            <h3 class="text-xl sm:text-2xl mb-1 truncate font-bold"><%= @project.title %></h3>
            <div class="text-sm sm:text-base text-gray-700">
              <div><%= @project.description %></div>
            </div>
            <div class="flex flex-wrap gap-2 mt-3">
              <% if @project.demo_link.present? %>
                <%= render C::StyledButton.new(
                    text: "Demo",
                    link: @project.demo_link,
                    link_target: "_blank",
                    icon: "world.svg",
                    onclick: "event.stopPropagation()") %>
              <% end %>
              <% if @project.repo_link.present? %>
                <%= render C::StyledButton.new(
                    text: "Repository",
                    link: @project.repo_link,
                    link_target: "_blank",
                    icon: "git.svg",
                    onclick: "event.stopPropagation()") %>
              <% end %>
              <%= render "shared/report", suspect: @project, already_reported: FraudReport.already_reported_by?(current_user, @project) %>
            </div>
          </div>
        </div>
      </div>

      <div class="space-y-4 max-h-[calc(100vh-16rem)] overflow-y-auto pr-2">
        <% @devlogs.each do |devlog| %>
          <%= render "devlogs/devlog_card",
              devlog: devlog,
              context: 'voting',
              show_comments_inline: false,
              show_comment_modal: false,
              show_likes: false,
              content_margin: 'p-2',
              no_parchment: true %>
        <% end %>
      </div>
    </div>

    <!-- RHS -->
    <div class="lg:sticky lg:top-4 lg:h-fit">
      <%= render C::Container.new do %>
        <div class="p-3 sm:p-4">
          <%= form_with url: showcase_path, method: :post, data: { turbo: true }, class: "space-y-2" do |f| %>
            <%= hidden_field_tag :project_id, @project.id %>
            <%= hidden_field_tag :time_spent_voting_ms, 0, id: "time_spent_voting_ms" %>

            <div class="mb-4">
              <h2 class="text-xl font-bold text-som-dark mb-2">Your grades, cowboy</h2>
            </div>

            <div class="space-y-3">
              <% explain = {
                "technical" => "Engineering quality: Do you think the author has put in effort in ensuring the robustness, perfomance and correctness of this?",
                "creativity" => "Is this creative?",
                "storytelling" => "How well it tells how it was made: clear README/devlogs, documentation, etc",
                "originality" => "How distinct it is from common projects?"
              } %>
              <% @criteria.each do |criterion| %>
                <div class="bg-[#f8f1e6] border border-[#d5bfa6] rounded-lg p-3">
                  <div class="mb-1 font-bold text-lg text-som-dark capitalize"><%= criterion %></div>
                  <p class="mb-2 text-sm text-som-dark/85"><%= explain[criterion.to_s] %></p>

                  <div class="star-rating"
                       data-controller="star-rating"
                       data-star-rating-criterion-value="<%= criterion %>"
                       data-star-rating-labels-value="<%= @grade_labels.to_json %>">
                    <input type="hidden" name="vote_mf[ballot][<%= criterion %>]" id="rating_<%= criterion %>" required>
                    <div class="flex items-center gap-1">
                      <% 6.times do |i| %>
                        <button type="button"
                                class="text-3xl transition-all hover:scale-110 pb-1"
                                data-star-rating-target="star"
                                data-action="click->star-rating#selectRating mouseenter->star-rating#hoverRating mouseleave->star-rating#leaveRating"
                                data-value="<%= i + 1 %>">
                          <span class="text-gray-300">â˜…</span>
                        </button>
                      <% end %>
                      <span class="ml-3 text-sm text-som-dark/70" data-star-rating-target="label"></span>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="flex justify-center items-center w-full mt-4">
              <%= render C::StyledButton.new(text: "Submit", type: :submit) %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

  </div>
</div>
