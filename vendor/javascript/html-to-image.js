// html-to-image@1.11.13 downloaded from https://ga.jspm.io/npm:html-to-image@1.11.13/es/index.js

function resolveUrl(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument();const o=n.createElement("base");const r=n.createElement("a");n.head.appendChild(o);n.body.appendChild(r);t&&(o.href=t);r.href=e;return r.href}const e=(()=>{let e=0;const random=()=>`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4);return()=>{e+=1;return`u${random()}${e}`}})();function toArray(e){const t=[];for(let n=0,o=e.length;n<o;n++)t.push(e[n]);return t}let t=null;function getStyleProperties(e={}){if(t)return t;if(e.includeStyleProperties){t=e.includeStyleProperties;return t}t=toArray(window.getComputedStyle(document.documentElement));return t}function px(e,t){const n=e.ownerDocument.defaultView||window;const o=n.getComputedStyle(e).getPropertyValue(t);return o?parseFloat(o.replace("px","")):0}function getNodeWidth(e){const t=px(e,"border-left-width");const n=px(e,"border-right-width");return e.clientWidth+t+n}function getNodeHeight(e){const t=px(e,"border-top-width");const n=px(e,"border-bottom-width");return e.clientHeight+t+n}function getImageSize(e,t={}){const n=t.width||getNodeWidth(e);const o=t.height||getNodeHeight(e);return{width:n,height:o}}function getPixelRatio(){let e;let t;try{t=process}catch(e){}const n=t&&t.env?t.env.devicePixelRatio:null;if(n){e=parseInt(n,10);Number.isNaN(e)&&(e=1)}return e||window.devicePixelRatio||1}const n=16384;function checkCanvasDimensions(e){if(e.width>n||e.height>n)if(e.width>n&&e.height>n)if(e.width>e.height){e.height*=n/e.width;e.width=n}else{e.width*=n/e.height;e.height=n}else if(e.width>n){e.height*=n/e.width;e.width=n}else{e.width*=n/e.height;e.height=n}}function canvasToBlob(e,t={}){return e.toBlob?new Promise((n=>{e.toBlob(n,t.type?t.type:"image/png",t.quality?t.quality:1)})):new Promise((n=>{const o=window.atob(e.toDataURL(t.type?t.type:void 0,t.quality?t.quality:void 0).split(",")[1]);const r=o.length;const a=new Uint8Array(r);for(let e=0;e<r;e+=1)a[e]=o.charCodeAt(e);n(new Blob([a],{type:t.type?t.type:"image/png"}))}))}function createImage(e){return new Promise(((t,n)=>{const o=new Image;o.onload=()=>{o.decode().then((()=>{requestAnimationFrame((()=>t(o)))}))};o.onerror=n;o.crossOrigin="anonymous";o.decoding="async";o.src=e}))}async function svgToDataURL(e){return Promise.resolve().then((()=>(new XMLSerializer).serializeToString(e))).then(encodeURIComponent).then((e=>`data:image/svg+xml;charset=utf-8,${e}`))}async function nodeToDataURL(e,t,n){const o="http://www.w3.org/2000/svg";const r=document.createElementNS(o,"svg");const a=document.createElementNS(o,"foreignObject");r.setAttribute("width",`${t}`);r.setAttribute("height",`${n}`);r.setAttribute("viewBox",`0 0 ${t} ${n}`);a.setAttribute("width","100%");a.setAttribute("height","100%");a.setAttribute("x","0");a.setAttribute("y","0");a.setAttribute("externalResourcesRequired","true");r.appendChild(a);a.appendChild(e);return svgToDataURL(r)}const isInstanceOfElement=(e,t)=>{if(e instanceof t)return true;const n=Object.getPrototypeOf(e);return n!==null&&(n.constructor.name===t.name||isInstanceOfElement(n,t))};function formatCSSText(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function formatCSSProperties(e,t){return getStyleProperties(t).map((t=>{const n=e.getPropertyValue(t);const o=e.getPropertyPriority(t);return`${t}: ${n}${o?" !important":""};`})).join(" ")}function getPseudoElementStyle(e,t,n,o){const r=`.${e}:${t}`;const a=n.cssText?formatCSSText(n):formatCSSProperties(n,o);return document.createTextNode(`${r}{${a}}`)}function clonePseudoElement(t,n,o,r){const a=window.getComputedStyle(t,o);const s=a.getPropertyValue("content");if(s===""||s==="none")return;const c=e();try{n.className=`${n.className} ${c}`}catch(e){return}const i=document.createElement("style");i.appendChild(getPseudoElementStyle(c,o,a,r));n.appendChild(i)}function clonePseudoElements(e,t,n){clonePseudoElement(e,t,":before",n);clonePseudoElement(e,t,":after",n)}const o="application/font-woff";const r="image/jpeg";const a={woff:o,woff2:o,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:r,jpeg:r,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function getExtension(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function getMimeType(e){const t=getExtension(e).toLowerCase();return a[t]||""}function getContentFromDataUrl(e){return e.split(/,/)[1]}function isDataUrl(e){return e.search(/^(data:)/)!==-1}function makeDataUrl(e,t){return`data:${t};base64,${e}`}async function fetchAsDataURL(e,t,n){const o=await fetch(e,t);if(o.status===404)throw new Error(`Resource "${o.url}" not found`);const r=await o.blob();return new Promise(((e,t)=>{const a=new FileReader;a.onerror=t;a.onloadend=()=>{try{e(n({res:o,result:a.result}))}catch(e){t(e)}};a.readAsDataURL(r)}))}const s={};function getCacheKey(e,t,n){let o=e.replace(/\?.*/,"");n&&(o=e);/ttf|otf|eot|woff2?/i.test(o)&&(o=o.replace(/.*\//,""));return t?`[${t}]${o}`:o}async function resourceToDataURL(e,t,n){const o=getCacheKey(e,t,n.includeQueryParams);if(s[o]!=null)return s[o];n.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());let r;try{const o=await fetchAsDataURL(e,n.fetchRequestInit,(({res:e,result:n})=>{t||(t=e.headers.get("Content-Type")||"");return getContentFromDataUrl(n)}));r=makeDataUrl(o,t)}catch(t){r=n.imagePlaceholder||"";let o=`Failed to fetch resource: ${e}`;t&&(o=typeof t==="string"?t:t.message);o&&console.warn(o)}s[o]=r;return r}async function cloneCanvasElement(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(false):createImage(t)}async function cloneVideoElement(e,t){if(e.currentSrc){const t=document.createElement("canvas");const n=t.getContext("2d");t.width=e.clientWidth;t.height=e.clientHeight;n===null||n===void 0?void 0:n.drawImage(e,0,0,t.width,t.height);const o=t.toDataURL();return createImage(o)}const n=e.poster;const o=getMimeType(n);const r=await resourceToDataURL(n,o,t);return createImage(r)}async function cloneIFrameElement(e,t){var n;try{if((n=e===null||e===void 0?void 0:e.contentDocument)===null||n===void 0?void 0:n.body)return await cloneNode(e.contentDocument.body,t,true)}catch(e){}return e.cloneNode(false)}async function cloneSingleNode(e,t){return isInstanceOfElement(e,HTMLCanvasElement)?cloneCanvasElement(e):isInstanceOfElement(e,HTMLVideoElement)?cloneVideoElement(e,t):isInstanceOfElement(e,HTMLIFrameElement)?cloneIFrameElement(e,t):e.cloneNode(isSVGElement(e))}const isSlotElement=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";const isSVGElement=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function cloneChildren(e,t,n){var o,r;if(isSVGElement(t))return t;let a=[];a=isSlotElement(e)&&e.assignedNodes?toArray(e.assignedNodes()):isInstanceOfElement(e,HTMLIFrameElement)&&((o=e.contentDocument)===null||o===void 0?void 0:o.body)?toArray(e.contentDocument.body.childNodes):toArray(((r=e.shadowRoot)!==null&&r!==void 0?r:e).childNodes);if(a.length===0||isInstanceOfElement(e,HTMLVideoElement))return t;await a.reduce(((e,o)=>e.then((()=>cloneNode(o,n))).then((e=>{e&&t.appendChild(e)}))),Promise.resolve());return t}function cloneCSSStyle(e,t,n){const o=t.style;if(!o)return;const r=window.getComputedStyle(e);if(r.cssText){o.cssText=r.cssText;o.transformOrigin=r.transformOrigin}else getStyleProperties(n).forEach((n=>{let a=r.getPropertyValue(n);if(n==="font-size"&&a.endsWith("px")){const e=Math.floor(parseFloat(a.substring(0,a.length-2)))-.1;a=`${e}px`}isInstanceOfElement(e,HTMLIFrameElement)&&n==="display"&&a==="inline"&&(a="block");n==="d"&&t.getAttribute("d")&&(a=`path(${t.getAttribute("d")})`);o.setProperty(n,a,r.getPropertyPriority(n))}))}function cloneInputValue(e,t){isInstanceOfElement(e,HTMLTextAreaElement)&&(t.innerHTML=e.value);isInstanceOfElement(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function cloneSelectValue(e,t){if(isInstanceOfElement(e,HTMLSelectElement)){const n=t;const o=Array.from(n.children).find((t=>e.value===t.getAttribute("value")));o&&o.setAttribute("selected","")}}function decorate(e,t,n){if(isInstanceOfElement(t,Element)){cloneCSSStyle(e,t,n);clonePseudoElements(e,t,n);cloneInputValue(e,t);cloneSelectValue(e,t)}return t}async function ensureSVGSymbols(e,t){const n=e.querySelectorAll?e.querySelectorAll("use"):[];if(n.length===0)return e;const o={};for(let r=0;r<n.length;r++){const a=n[r];const s=a.getAttribute("xlink:href");if(s){const n=e.querySelector(s);const r=document.querySelector(s);n||!r||o[s]||(o[s]=await cloneNode(r,t,true))}}const r=Object.values(o);if(r.length){const t="http://www.w3.org/1999/xhtml";const n=document.createElementNS(t,"svg");n.setAttribute("xmlns",t);n.style.position="absolute";n.style.width="0";n.style.height="0";n.style.overflow="hidden";n.style.display="none";const o=document.createElementNS(t,"defs");n.appendChild(o);for(let e=0;e<r.length;e++)o.appendChild(r[e]);e.appendChild(n)}return e}async function cloneNode(e,t,n){return n||!t.filter||t.filter(e)?Promise.resolve(e).then((e=>cloneSingleNode(e,t))).then((n=>cloneChildren(e,n,t))).then((n=>decorate(e,n,t))).then((e=>ensureSVGSymbols(e,t))):null}const c=/url\((['"]?)([^'"]+?)\1\)/g;const i=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g;const l=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function toRegex(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function parseURLs(e){const t=[];e.replace(c,((e,n,o)=>{t.push(o);return e}));return t.filter((e=>!isDataUrl(e)))}async function embed(e,t,n,o,r){try{const a=n?resolveUrl(t,n):t;const s=getMimeType(t);let c;if(r){const e=await r(a);c=makeDataUrl(e,s)}else c=await resourceToDataURL(a,s,o);return e.replace(toRegex(t),`$1${c}$3`)}catch(e){}return e}function filterPreferredFontFormat(e,{preferredFontFormat:t}){return t?e.replace(l,(e=>{while(true){const[n,,o]=i.exec(e)||[];if(!o)return"";if(o===t)return`src: ${n};`}})):e}function shouldEmbed(e){return e.search(c)!==-1}async function embedResources(e,t,n){if(!shouldEmbed(e))return e;const o=filterPreferredFontFormat(e,n);const r=parseURLs(o);return r.reduce(((e,o)=>e.then((e=>embed(e,o,t,n)))),Promise.resolve(o))}async function embedProp(e,t,n){var o;const r=(o=t.style)===null||o===void 0?void 0:o.getPropertyValue(e);if(r){const o=await embedResources(r,null,n);t.style.setProperty(e,o,t.style.getPropertyPriority(e));return true}return false}async function embedBackground(e,t){await embedProp("background",e,t)||await embedProp("background-image",e,t);await embedProp("mask",e,t)||await embedProp("-webkit-mask",e,t)||await embedProp("mask-image",e,t)||await embedProp("-webkit-mask-image",e,t)}async function embedImageNode(e,t){const n=isInstanceOfElement(e,HTMLImageElement);if(!(n&&!isDataUrl(e.src))&&!(isInstanceOfElement(e,SVGImageElement)&&!isDataUrl(e.href.baseVal)))return;const o=n?e.src:e.href.baseVal;const r=await resourceToDataURL(o,getMimeType(o),t);await new Promise(((o,a)=>{e.onload=o;e.onerror=t.onImageErrorHandler?(...e)=>{try{o(t.onImageErrorHandler(...e))}catch(e){a(e)}}:a;const s=e;s.decode&&(s.decode=o);s.loading==="lazy"&&(s.loading="eager");if(n){e.srcset="";e.src=r}else e.href.baseVal=r}))}async function embedChildren(e,t){const n=toArray(e.childNodes);const o=n.map((e=>embedImages(e,t)));await Promise.all(o).then((()=>e))}async function embedImages(e,t){if(isInstanceOfElement(e,Element)){await embedBackground(e,t);await embedImageNode(e,t);await embedChildren(e,t)}}function applyStyle(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor);t.width&&(n.width=`${t.width}px`);t.height&&(n.height=`${t.height}px`);const o=t.style;o!=null&&Object.keys(o).forEach((e=>{n[e]=o[e]}));return e}const u={};async function fetchCSS(e){let t=u[e];if(t!=null)return t;const n=await fetch(e);const o=await n.text();t={url:e,cssText:o};u[e]=t;return t}async function embedFonts(e,t){let n=e.cssText;const o=/url\(["']?([^"')]+)["']?\)/g;const r=n.match(/url\([^)]+\)/g)||[];const a=r.map((async r=>{let a=r.replace(o,"$1");a.startsWith("https://")||(a=new URL(a,e.url).href);return fetchAsDataURL(a,t.fetchRequestInit,(({result:e})=>{n=n.replace(r,`url(${e})`);return[r,e]}))}));return Promise.all(a).then((()=>n))}function parseCSS(e){if(e==null)return[];const t=[];const n=/(\/\*[\s\S]*?\*\/)/gi;let o=e.replace(n,"");const r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");while(true){const e=r.exec(o);if(e===null)break;t.push(e[0])}o=o.replace(r,"");const a=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;const s="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})";const c=new RegExp(s,"gi");while(true){let e=a.exec(o);if(e===null){e=c.exec(o);if(e===null)break;a.lastIndex=c.lastIndex}else c.lastIndex=a.lastIndex;t.push(e[0])}return t}async function getCSSRules(e,t){const n=[];const o=[];e.forEach((n=>{if("cssRules"in n)try{toArray(n.cssRules||[]).forEach(((e,r)=>{if(e.type===CSSRule.IMPORT_RULE){let a=r+1;const s=e.href;const c=fetchCSS(s).then((e=>embedFonts(e,t))).then((e=>parseCSS(e).forEach((e=>{try{n.insertRule(e,e.startsWith("@import")?a+=1:n.cssRules.length)}catch(t){console.error("Error inserting rule from remote css",{rule:e,error:t})}})))).catch((e=>{console.error("Error loading remote css",e.toString())}));o.push(c)}}))}catch(r){const a=e.find((e=>e.href==null))||document.styleSheets[0];n.href!=null&&o.push(fetchCSS(n.href).then((e=>embedFonts(e,t))).then((e=>parseCSS(e).forEach((e=>{a.insertRule(e,a.cssRules.length)})))).catch((e=>{console.error("Error loading remote stylesheet",e)})));console.error("Error inlining remote css file",r)}}));return Promise.all(o).then((()=>{e.forEach((e=>{if("cssRules"in e)try{toArray(e.cssRules||[]).forEach((e=>{n.push(e)}))}catch(t){console.error(`Error while reading CSS rules from ${e.href}`,t)}}));return n}))}function getWebFontRules(e){return e.filter((e=>e.type===CSSRule.FONT_FACE_RULE)).filter((e=>shouldEmbed(e.style.getPropertyValue("src"))))}async function parseWebFontRules(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const n=toArray(e.ownerDocument.styleSheets);const o=await getCSSRules(n,t);return getWebFontRules(o)}function normalizeFontFamily(e){return e.trim().replace(/["']/g,"")}function getUsedFonts(e){const t=new Set;function traverse(e){const n=e.style.fontFamily||getComputedStyle(e).fontFamily;n.split(",").forEach((e=>{t.add(normalizeFontFamily(e))}));Array.from(e.children).forEach((e=>{e instanceof HTMLElement&&traverse(e)}))}traverse(e);return t}async function getWebFontCSS(e,t){const n=await parseWebFontRules(e,t);const o=getUsedFonts(e);const r=await Promise.all(n.filter((e=>o.has(normalizeFontFamily(e.style.fontFamily)))).map((e=>{const n=e.parentStyleSheet?e.parentStyleSheet.href:null;return embedResources(e.cssText,n,t)})));return r.join("\n")}async function embedWebFonts(e,t){const n=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await getWebFontCSS(e,t);if(n){const t=document.createElement("style");const o=document.createTextNode(n);t.appendChild(o);e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}}async function toSvg(e,t={}){const{width:n,height:o}=getImageSize(e,t);const r=await cloneNode(e,t,true);await embedWebFonts(r,t);await embedImages(r,t);applyStyle(r,t);const a=await nodeToDataURL(r,n,o);return a}async function toCanvas(e,t={}){const{width:n,height:o}=getImageSize(e,t);const r=await toSvg(e,t);const a=await createImage(r);const s=document.createElement("canvas");const c=s.getContext("2d");const i=t.pixelRatio||getPixelRatio();const l=t.canvasWidth||n;const u=t.canvasHeight||o;s.width=l*i;s.height=u*i;t.skipAutoScale||checkCanvasDimensions(s);s.style.width=`${l}`;s.style.height=`${u}`;if(t.backgroundColor){c.fillStyle=t.backgroundColor;c.fillRect(0,0,s.width,s.height)}c.drawImage(a,0,0,s.width,s.height);return s}async function toPixelData(e,t={}){const{width:n,height:o}=getImageSize(e,t);const r=await toCanvas(e,t);const a=r.getContext("2d");return a.getImageData(0,0,n,o).data}async function toPng(e,t={}){const n=await toCanvas(e,t);return n.toDataURL()}async function toJpeg(e,t={}){const n=await toCanvas(e,t);return n.toDataURL("image/jpeg",t.quality||1)}async function toBlob(e,t={}){const n=await toCanvas(e,t);const o=await canvasToBlob(n);return o}async function getFontEmbedCSS(e,t={}){return getWebFontCSS(e,t)}export{getFontEmbedCSS,toBlob,toCanvas,toJpeg,toPixelData,toPng,toSvg};

